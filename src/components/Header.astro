---
// src/components/Header.astro
import { supabase } from '../lib/supabase';

const links = [
  { href: "/", label: "Home" },
  { href: "/current-affairs", label: "Current Affairs" },
  { href: "/entertainment", label: "Entertainment" },
  { href: "/sport", label: "Sport" },
];

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ cookies
const accessToken = Astro.cookies.get("sb-access-token");
const refreshToken = Astro.cookies.get("sb-refresh-token");

let isLoggedIn = false;
let user = null;

if (accessToken && refreshToken) {
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é –≤ supabase
  await supabase.auth.setSession({
    access_token: accessToken.value,
    refresh_token: refreshToken.value,
  });
  
  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const { data: { user: currentUser }, error } = await supabase.auth.getUser();
  
  if (currentUser && !error) {
    isLoggedIn = true;
    user = currentUser;
  }
}
---

<header class="bg-gray-900 text-white p-4 flex justify-between items-center">
  <h1 class="text-xl font-bold">üì∞ MyNews</h1>

  <div class="flex items-center space-x-6">
    <nav class="space-x-4">
      {links.map(link => (
        <a href={link.href} class="hover:text-yellow-400">{link.label}</a>
      ))}
    </nav>

    <div class="flex items-center space-x-2">
      {isLoggedIn ? (
        <>
          <span class="text-sm text-gray-300">–ü—Ä–∏–≤–µ—Ç, {user?.email}</span>
          <a href="/dashboard" class="px-3 py-1 bg-blue-600 rounded hover:bg-blue-700 transition">Dashboard</a>
          <a href="/api/signout" class="px-3 py-1 bg-red-600 rounded hover:bg-red-700 transition">
            Sign Out
          </a>
        </>
      ) : (
        <>
          <a href="/signin" class="px-3 py-1 bg-blue-600 rounded hover:bg-blue-700 transition">Log In</a>
          <a href="/register" class="px-3 py-1 bg-green-600 rounded hover:bg-green-700 transition">Sign Up</a>
        </>
      )}
    </div>
  </div>
</header>